{{!--
  Chat-Pruner V2 Template
  Version: v13.1.3.7
  Compatible with module-v2.js rewrite
  Context fields: isGM, messages[], count, selectedCount, canDelete, filters
--}}

<div class="cp-container flexcol">

  {{!-- Header / Controls --}}
  <header class="cp-header flexrow space-between align-center">
    <h2><i class="fa-solid fa-scissors"></i> Chat Pruner</h2>
    <div class="cp-mode-toggle">
      <button type="button" data-action="cp.toggleMode" class="cp-btn">
        Mode: {{anchorMode}}
      </button>
      <button type="button" data-action="cp.selectAll" class="cp-btn">Select All</button>
      <button type="button" data-action="cp.selectNone" class="cp-btn">Clear</button>
    </div>
  </header>

  {{!-- Filters Form --}}
  <form class="cp-filters" autocomplete="off">
    <div class="flexrow">
      <label><input type="checkbox" name="includeWhispers" {{checked includeWhispers}}> Whispers</label>
      <label><input type="checkbox" name="includeRolls" {{checked includeRolls}}> Rolls</label>
      <label><input type="checkbox" name="includeSystem" {{checked includeSystem}}> System</label>
      <label>Limit: <input type="number" name="limit" value="{{limit}}" min="10" max="5000" step="10" style="width:5em;"></label>
      <label>Search: <input type="text" name="query" value="{{query}}" placeholder="text..."></label>
    </div>
  </form>

  <hr>

  {{!-- List of messages --}}
  <section class="cp-list scrollable">
    {{#if messages.length}}
      {{#each messages}}
      <article class="cp-msg flexrow align-start {{#if selected}}selected{{/if}}" data-id="{{id}}">
        <div class="cp-select">
          <input type="checkbox" data-action="cp.toggle" data-id="{{id}}" {{checked selected}}>
        </div>
        <div class="cp-meta grow">
          <div class="cp-line1 flexrow space-between">
            <span class="cp-author">{{author}}</span>
            <span class="cp-timestamp">{{timestamp ts}}</span>
          </div>
          <div class="cp-content">{{{content}}}</div>
        </div>
        <div class="cp-anchor">
          <button type="button" class="cp-btn-icon" data-action="cp.setAnchor" data-id="{{id}}" title="Set Anchor">
            <i class="fa-solid fa-anchor"></i>
          </button>
        </div>
      </article>
      {{/each}}
    {{else}}
      <p class="cp-empty">No messages match the filters.</p>
    {{/if}}
  </section>

  <hr>

  {{!-- Footer / Actions --}}
  <footer class="cp-footer flexrow space-between align-center">
    <div class="cp-status">
      <span>{{count}} messages</span>
      <span>• {{selectedCount}} selected</span>
      {{#if anchorId}}
        <span>• Anchor: {{anchorMode}} of {{anchorId}}</span>
      {{/if}}
    </div>
    <div class="cp-actions">
      {{#if isGM}}
        <button type="button" data-action="cp.delete" class="cp-btn-danger" {{disabled (not canDelete)}}>
          <i class="fa-solid fa-trash"></i> Delete Selected
        </button>
      {{else}}
        <em>GM-only pruning</em>
      {{/if}}
    </div>
  </footer>
</div>
